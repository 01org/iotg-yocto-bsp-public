From 6536d4a691d47b6a7badebe54bf546fddb23ea04 Mon Sep 17 00:00:00 2001
From: Matt Roper <matthew.d.roper@intel.com>
Date: Fri, 12 Feb 2016 17:59:11 -0800
Subject: [PATCH 13/14] xf86drmMode: Add plane blending helpers

For use with kernel's GL-style plane blending properties.

Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 tests/modetest/modetest.c |  1 +
 xf86drmMode.h             | 17 +++++++++++++++++
 2 files changed, 18 insertions(+)

diff --git a/tests/modetest/modetest.c b/tests/modetest/modetest.c
index 62957d8..243f513 100644
--- a/tests/modetest/modetest.c
+++ b/tests/modetest/modetest.c
@@ -615,6 +615,7 @@ static struct resources *get_resources(struct device *dev)
 		return NULL;
 
 	drmSetClientCap(dev->fd, DRM_CLIENT_CAP_UNIVERSAL_PLANES, 1);
+	drmSetClientCap(dev->fd, DRM_CLIENT_CAP_ATOMIC, 1);
 
 	res->res = drmModeGetResources(dev->fd);
 	if (!res->res) {
diff --git a/xf86drmMode.h b/xf86drmMode.h
index ebb18c0..f8608bc 100644
--- a/xf86drmMode.h
+++ b/xf86drmMode.h
@@ -551,6 +551,23 @@ extern drmModeObjectListPtr drmModeGetLease(int fd);
 
 extern int drmModeRevokeLease(int fd, uint32_t lessee_id);
 
+enum drm_blend_factor {
+	DRM_BLEND_FACTOR_AUTO,
+	DRM_BLEND_FACTOR_ZERO,
+	DRM_BLEND_FACTOR_ONE,
+	DRM_BLEND_FACTOR_SRC_ALPHA,
+	DRM_BLEND_FACTOR_ONE_MINUS_SRC_ALPHA,
+	DRM_BLEND_FACTOR_CONSTANT_ALPHA,
+	DRM_BLEND_FACTOR_ONE_MINUS_CONSTANT_ALPHA,
+	DRM_BLEND_FACTOR_CONSTANT_ALPHA_TIMES_SRC_ALPHA,
+	DRM_BLEND_FACTOR_ONE_MINUS_CONSTANT_ALPHA_TIMES_SRC_ALPHA,
+};
+
+#define DRM_BLEND_FUNC(src_factor, dst_factor)         \
+       (DRM_BLEND_FACTOR_##src_factor << 16 | DRM_BLEND_FACTOR_##dst_factor)
+#define DRM_BLEND_FUNC_SRC_FACTOR(val) (((val) >> 16) & 0xffff)
+#define DRM_BLEND_FUNC_DST_FACTOR(val) ((val) & 0xffff)
+
 #if defined(__cplusplus)
 }
 #endif
-- 
1.9.1


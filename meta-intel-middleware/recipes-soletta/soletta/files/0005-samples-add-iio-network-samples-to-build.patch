From f111d557450a8217f562789d935eac6f7f949c4c Mon Sep 17 00:00:00 2001
From: "Lay, Kuan Loon" <kuan.loon.lay@intel.com>
Date: Wed, 17 Aug 2016 22:14:34 +0800
Subject: [PATCH 05/11] samples: add iio+network samples to build

Upstream-Status: Pending

Signed-off-by: Lay, Kuan Loon <kuan.loon.lay@intel.com>
---
 Kconfig                                            |    1
 src/samples/flow/iio+network/Kconfig               |    4 +++
 src/samples/flow/iio+network/Makefile              |    7 ++++
 .../ambient-light-and-proximity-console.fbp        |   26 ++++++++++++++
 .../ambient-light-and-proximity-mqtt.fbp           |   30 ++++++++++++++++
 .../iio+network/ambient-light-and-proximity.fbp    |   36 ++++++++++++++++++++
 .../flow/iio+network/sol-flow-SoFIA-3GR.json       |   21 ++++++++++++
 7 files changed, 125 insertions(+)
 create mode 100644 src/samples/flow/iio+network/Kconfig
 create mode 100644 src/samples/flow/iio+network/Makefile
 create mode 100755 src/samples/flow/iio+network/ambient-light-and-proximity-console.fbp
 create mode 100755 src/samples/flow/iio+network/ambient-light-and-proximity-mqtt.fbp
 create mode 100755 src/samples/flow/iio+network/ambient-light-and-proximity.fbp
 create mode 100644 src/samples/flow/iio+network/sol-flow-SoFIA-3GR.json

diff --git a/Kconfig b/Kconfig
index 1e55138..b86be0b 100644
--- a/Kconfig
+++ b/Kconfig
@@ -228,6 +228,7 @@ source "src/samples/flow/semaphore-monitor/Kconfig"
 source "src/samples/flow/trash-disposer/Kconfig"
 source "src/samples/flow/unix-socket/Kconfig"
 source "src/samples/flow/webservices/Kconfig"
+source "src/samples/flow/iio+network/Kconfig"
 
 endmenu
 
diff --git a/src/samples/flow/iio+network/Kconfig b/src/samples/flow/iio+network/Kconfig
new file mode 100644
index 0000000..24479eb
--- /dev/null
+++ b/src/samples/flow/iio+network/Kconfig
@@ -0,0 +1,4 @@
+config FLOW_IIO_NETWORK_SAMPLE
+	bool
+	depends on FLOW_FBP_GENERATOR_SAMPLES && FLOW_NODE_TYPE_IIO && FLOW_NODE_TYPE_TIMER && FLOW_NODE_TYPE_CONSOLE && FLOW_NODE_TYPE_MQTT && FLOW_NODE_TYPE_STRING && FLOW_NODE_TYPE_CONVERTER
+	default y
diff --git a/src/samples/flow/iio+network/Makefile b/src/samples/flow/iio+network/Makefile
new file mode 100644
index 0000000..7cb9b99
--- /dev/null
+++ b/src/samples/flow/iio+network/Makefile
@@ -0,0 +1,7 @@
+sample-$(FLOW_IIO_NETWORK_SAMPLE) += ambient-light-and-proximity-console
+sample-ambient-light-and-proximity-console-$(FLOW_IIO_NETWORK_SAMPLE) := ambient-light-and-proximity-console.fbp
+sample-ambient-light-and-proximity-console-$(FLOW_IIO_NETWORK_SAMPLE)-conffile := sol-flow-SoFIA-3GR.json
+
+sample-$(FLOW_IIO_NETWORK_SAMPLE) += ambient-light-and-proximity-mqtt
+sample-ambient-light-and-proximity-mqtt-$(FLOW_IIO_NETWORK_SAMPLE) := ambient-light-and-proximity-mqtt.fbp
+sample-ambient-light-and-proximity-mqtt-$(FLOW_IIO_NETWORK_SAMPLE)-conffile := sol-flow-SoFIA-3GR.json
diff --git a/src/samples/flow/iio+network/ambient-light-and-proximity-console.fbp b/src/samples/flow/iio+network/ambient-light-and-proximity-console.fbp
new file mode 100755
index 0000000..75a13ea
--- /dev/null
+++ b/src/samples/flow/iio+network/ambient-light-and-proximity-console.fbp
@@ -0,0 +1,26 @@
+#!/usr/bin/env sol-fbp-runner
+
+# This file is part of the Soletta (TM) Project
+#
+# Copyright (C) 2016 Intel Corporation. All rights reserved.
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#     http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+# Print IIO ambient light luminance and proximity reading in console
+
+DECLARE=ambient-light-and-proximity:fbp:ambient-light-and-proximity.fbp
+amb_prox(ambient-light-and-proximity:interval=1000)
+
+amb_prox LUX -> IN _(console:prefix="Lux: ")
+amb_prox PROXIMITY -> IN _(console:prefix="Proximity: ")
+
diff --git a/src/samples/flow/iio+network/ambient-light-and-proximity-mqtt.fbp b/src/samples/flow/iio+network/ambient-light-and-proximity-mqtt.fbp
new file mode 100755
index 0000000..b8a1ce1
--- /dev/null
+++ b/src/samples/flow/iio+network/ambient-light-and-proximity-mqtt.fbp
@@ -0,0 +1,30 @@
+#!/usr/bin/env sol-fbp-runner
+
+# This file is part of the Soletta (TM) Project
+#
+# Copyright (C) 2016 Intel Corporation. All rights reserved.
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#     http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+# Publish IIO ambient light luminance and proximity reading through MQTT
+
+DECLARE=ambient-light-and-proximity:fbp:ambient-light-and-proximity.fbp
+amb_prox(ambient-light-and-proximity:interval=1000)
+
+# publish
+pub(mqtt/client:host="127.0.0.1",topic="soletta/mqtt/sensor_data")
+
+amb_prox SENSOR_STRING -> IN convert(converter/string-to-blob) OUT -> DATA pub
+
+convert OUT -> PUBLISH pub
+
diff --git a/src/samples/flow/iio+network/ambient-light-and-proximity.fbp b/src/samples/flow/iio+network/ambient-light-and-proximity.fbp
new file mode 100755
index 0000000..9e0e401
--- /dev/null
+++ b/src/samples/flow/iio+network/ambient-light-and-proximity.fbp
@@ -0,0 +1,36 @@
+#!/usr/bin/env sol-fbp-runner
+
+# This file is part of the Soletta (TM) Project
+#
+# Copyright (C) 2016 Intel Corporation. All rights reserved.
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#     http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+# IIO ambient light luminance and proximity reading
+
+light(MyLight)
+proximity(MyProximity)
+
+# timer trigger sensor reading every seconds
+timer(timer:interval=1000)
+
+timer OUT -> TICK light OUT -> IN lux(converter/float-to-string:format_prefix="Lux: ")
+timer OUT -> TICK proximity OUT -> IN distance(converter/float-to-string:format_prefix="Proximity: ")
+
+lux OUT -> IN[0] concat(string/concatenate:separator=" ")
+distance OUT -> IN[1] concat
+
+OPTION=timer.interval:interval
+OUTPORT=light.OUT:LUX
+OUTPORT=proximity.OUT:PROXIMITY
+OUTPORT=concat.OUT:SENSOR_STRING
diff --git a/src/samples/flow/iio+network/sol-flow-SoFIA-3GR.json b/src/samples/flow/iio+network/sol-flow-SoFIA-3GR.json
new file mode 100644
index 0000000..8c2c4d8
--- /dev/null
+++ b/src/samples/flow/iio+network/sol-flow-SoFIA-3GR.json
@@ -0,0 +1,21 @@
+{
+  "$schema": "http://solettaproject.github.io/soletta/schemas/config.schema",
+  "nodetypes": [
+    {
+      "name": "MyLight",
+      "type": "iio/light-sensor",
+      "options": {
+        "iio_device": "apds99X0",
+        "buffer_size": -1
+      }
+    },
+    {
+      "name": "MyProximity",
+      "type": "iio/proximity-sensor",
+      "options": {
+        "iio_device": "apds99X0",
+        "buffer_size": -1
+      }
+    }
+  ]
+}
-- 
1.7.9.5


From 9814aab3040710929c583d4f1088149a2b5f79cb Mon Sep 17 00:00:00 2001
From: "Wong, Vincent Por Yin" <vincent.por.yin.wong@intel.com>
Date: Tue, 11 Dec 2018 10:27:43 +0800
Subject: [PATCH 2/4] PubSub: Fixes for amalgamation compilations.

Signed-off-by: Wong, Vincent Por Yin <vincent.por.yin.wong@intel.com>
---
 include/ua_server_pubsub.h            | 40 +++++++++++++--------------
 plugins/ua_network_pubsub_ethernet.h  |  2 +-
 plugins/ua_network_pubsub_udp.h       |  2 +-
 src/pubsub/ua_pubsub.h                |  2 +-
 src/pubsub/ua_pubsub_networkmessage.h |  4 +--
 5 files changed, 25 insertions(+), 25 deletions(-)

diff --git a/include/ua_server_pubsub.h b/include/ua_server_pubsub.h
index e054acf0..71b1394e 100644
--- a/include/ua_server_pubsub.h
+++ b/include/ua_server_pubsub.h
@@ -114,20 +114,20 @@ typedef struct {
     UA_Variant connectionTransportSettings;
 } UA_PubSubConnectionConfig;
 
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_Server_addPubSubConnection(UA_Server *server,
                               const UA_PubSubConnectionConfig *connectionConfig,
                               UA_NodeId *connectionIdentifier);
 
 /* Returns a deep copy of the config */
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_Server_getPubSubConnectionConfig(UA_Server *server,
                                     const UA_NodeId connection,
                                     UA_PubSubConnectionConfig *config);
 
 /* Remove Connection, identified by the NodeId. Deletion of Connection
  * removes all contained WriterGroups and Writers. */
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_Server_removePubSubConnection(UA_Server *server, const UA_NodeId connection);
 
 /**
@@ -182,7 +182,7 @@ typedef struct {
     } config;
 } UA_PublishedDataSetConfig;
 
-void
+void UA_EXPORT
 UA_PublishedDataSetConfig_deleteMembers(UA_PublishedDataSetConfig *pdsConfig);
 
 typedef struct {
@@ -192,20 +192,20 @@ typedef struct {
     UA_ConfigurationVersionDataType configurationVersion;
 } UA_AddPublishedDataSetResult;
 
-UA_AddPublishedDataSetResult
+UA_AddPublishedDataSetResult UA_EXPORT
 UA_Server_addPublishedDataSet(UA_Server *server,
                               const UA_PublishedDataSetConfig *publishedDataSetConfig,
                               UA_NodeId *pdsIdentifier);
 
 /* Returns a deep copy of the config */
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_Server_getPublishedDataSetConfig(UA_Server *server, const UA_NodeId pds,
                                     UA_PublishedDataSetConfig *config);
 
 /* Remove PublishedDataSet, identified by the NodeId. Deletion of PDS removes
  * all contained and linked PDS Fields. Connected WriterGroups will be also
  * removed. */
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_Server_removePublishedDataSet(UA_Server *server, const UA_NodeId pds);
 
 /**
@@ -236,7 +236,7 @@ typedef struct {
     } field;
 } UA_DataSetFieldConfig;
     
-void
+void UA_EXPORT
 UA_DataSetFieldConfig_deleteMembers(UA_DataSetFieldConfig *dataSetFieldConfig);
 
 typedef struct {
@@ -244,18 +244,18 @@ typedef struct {
     UA_ConfigurationVersionDataType configurationVersion;
 } UA_DataSetFieldResult;
 
-UA_DataSetFieldResult
+UA_DataSetFieldResult UA_EXPORT
 UA_Server_addDataSetField(UA_Server *server,
                           const UA_NodeId publishedDataSet,
                           const UA_DataSetFieldConfig *fieldConfig,
                           UA_NodeId *fieldIdentifier);
 
 /* Returns a deep copy of the config */
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_Server_getDataSetFieldConfig(UA_Server *server, const UA_NodeId dsf,
                                 UA_DataSetFieldConfig *config);
 
-UA_DataSetFieldResult
+UA_DataSetFieldResult UA_EXPORT
 UA_Server_removeDataSetField(UA_Server *server, const UA_NodeId dsf);
 
 /**
@@ -293,25 +293,25 @@ typedef struct {
     UA_UInt16 maxEncapsulatedDataSetMessageCount;
 } UA_WriterGroupConfig;
 
-void
+void UA_EXPORT
 UA_WriterGroupConfig_deleteMembers(UA_WriterGroupConfig *writerGroupConfig);
 
 /* Add a new WriterGroup to an existing Connection */
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_Server_addWriterGroup(UA_Server *server, const UA_NodeId connection,
                          const UA_WriterGroupConfig *writerGroupConfig,
                          UA_NodeId *writerGroupIdentifier);
 
 /* Returns a deep copy of the config */
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_Server_getWriterGroupConfig(UA_Server *server, const UA_NodeId writerGroup,
                                UA_WriterGroupConfig *config);
 
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_Server_updateWriterGroupConfig(UA_Server *server, UA_NodeId writerGroupIdentifier,
                                   const UA_WriterGroupConfig *config);
 
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_Server_removeWriterGroup(UA_Server *server, const UA_NodeId writerGroup);
 
 /**
@@ -336,7 +336,7 @@ typedef struct {
     UA_KeyValuePair *dataSetWriterProperties;
 } UA_DataSetWriterConfig;
 
-void
+void UA_EXPORT
 UA_DataSetWriterConfig_deleteMembers(UA_DataSetWriterConfig *pdsConfig);
 
 /* Add a new DataSetWriter to a existing WriterGroup. The DataSetWriter must be
@@ -345,18 +345,18 @@ UA_DataSetWriterConfig_deleteMembers(UA_DataSetWriterConfig *pdsConfig);
  * Part 14, 7.1.5.2.1 defines: The link between the PublishedDataSet and
  * DataSetWriter shall be created when an instance of the DataSetWriterType is
  * created. */
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_Server_addDataSetWriter(UA_Server *server,
                            const UA_NodeId writerGroup, const UA_NodeId dataSet,
                            const UA_DataSetWriterConfig *dataSetWriterConfig,
                            UA_NodeId *writerIdentifier);
 
 /* Returns a deep copy of the config */
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_Server_getDataSetWriterConfig(UA_Server *server, const UA_NodeId dsw,
                                  UA_DataSetWriterConfig *config);
 
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_Server_removeDataSetWriter(UA_Server *server, const UA_NodeId dsw);
 
 #endif /* UA_ENABLE_PUBSUB */
diff --git a/plugins/ua_network_pubsub_ethernet.h b/plugins/ua_network_pubsub_ethernet.h
index 90ebb9e5..5b00d0b3 100644
--- a/plugins/ua_network_pubsub_ethernet.h
+++ b/plugins/ua_network_pubsub_ethernet.h
@@ -11,7 +11,7 @@
 
 _UA_BEGIN_DECLS
 
-UA_PubSubTransportLayer
+UA_PubSubTransportLayer UA_EXPORT
 UA_PubSubTransportLayerEthernet(void);
 
 _UA_END_DECLS
diff --git a/plugins/ua_network_pubsub_udp.h b/plugins/ua_network_pubsub_udp.h
index 07a99129..1e0a75df 100644
--- a/plugins/ua_network_pubsub_udp.h
+++ b/plugins/ua_network_pubsub_udp.h
@@ -11,7 +11,7 @@
 
 _UA_BEGIN_DECLS
 
-UA_PubSubTransportLayer
+UA_PubSubTransportLayer UA_EXPORT
 UA_PubSubTransportLayerUDPMP(void);
 
 _UA_END_DECLS
diff --git a/src/pubsub/ua_pubsub.h b/src/pubsub/ua_pubsub.h
index 36d4c9e9..9e8a89f8 100644
--- a/src/pubsub/ua_pubsub.h
+++ b/src/pubsub/ua_pubsub.h
@@ -57,7 +57,7 @@ typedef struct{
 
 UA_StatusCode
 UA_PubSubConnectionConfig_copy(const UA_PubSubConnectionConfig *src, UA_PubSubConnectionConfig *dst);
-UA_PubSubConnection *
+UA_EXPORT UA_PubSubConnection *
 UA_PubSubConnection_findConnectionbyId(UA_Server *server, UA_NodeId connectionIdentifier);
 void
 UA_PubSubConnectionConfig_deleteMembers(UA_PubSubConnectionConfig *connectionConfig);
diff --git a/src/pubsub/ua_pubsub_networkmessage.h b/src/pubsub/ua_pubsub_networkmessage.h
index 9e38eb67..fb4ee1ac 100644
--- a/src/pubsub/ua_pubsub_networkmessage.h
+++ b/src/pubsub/ua_pubsub_networkmessage.h
@@ -202,14 +202,14 @@ UA_StatusCode
 UA_NetworkMessage_encodeBinary(const UA_NetworkMessage* src,
                                UA_Byte **bufPos, const UA_Byte *bufEnd);
 
-UA_StatusCode
+UA_StatusCode UA_EXPORT
 UA_NetworkMessage_decodeBinary(const UA_ByteString *src, size_t *offset,
                                UA_NetworkMessage* dst);
 
 size_t
 UA_NetworkMessage_calcSizeBinary(const UA_NetworkMessage* p);
 
-void
+void UA_EXPORT
 UA_NetworkMessage_deleteMembers(UA_NetworkMessage* p);
 
 void
-- 
2.17.1

